{%  import 'libnginx.j2' as ngx with context -%}

{%  set server_bulk = ngx.bulk_directives(ngx_settings.main | default({})) %}
{%  if server_bulk %}
{{    server_bulk }}
{{    '\n' }}
{%- endif -%}

{%  for context in ['events', 'http'] %}
{%    set content %}
{{      ngx.bulk_directives(ngx_settings[context] | default({})) }}
{%-   endset %}
{{    ngx.block(context, content) }}
{%-   if not loop.last %}
{{      '\n' }}
{%-   endif %}
{%  endfor %}
