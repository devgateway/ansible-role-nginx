{%  import 'libnginx.j2' as ngx with context -%}

{%  if ngx_settings.main is defined %}
{{    ngx.bulk_directives(ngx_settings.main) ~ '\n\n' }}
{%- endif -%}

{%  for context in ['events', 'http'] %}
{%    set content %}
{{      ngx.bulk_directives(ngx_settings[context] | default({})) }}
{%-   endset %}
{{    ngx.block(context, content) }}
{%-   if not loop.last %}
{{      '\n\n' }}
{%-   endif %}
{%  endfor %}
